<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
 <head>
  <title></title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
  <meta name='ocr-system' content='tesseract 5.0.0-alpha' />
  <meta name='ocr-capabilities' content='ocr_page ocr_carea ocr_par ocr_line ocrx_word ocrp_wconf'/>
 </head>
 <body>
  <div class='ocr_page' id='page_1' title='image "test_picture.jpg"; bbox 0 0 868 1199; ppageno 0'>
   <div class='ocr_carea' id='block_1_1' title="bbox 118 108 774 210">
    <p class='ocr_par' id='par_1_1' lang='eng' title="bbox 118 108 774 210">
     <span class='ocr_line' id='line_1_1' title="bbox 118 108 774 210; baseline 0.035 -33; x_size 88; x_descenders 17; x_ascenders 23">
      <span class='ocrx_word' id='word_1_1' title='bbox 118 108 289 182; x_wconf 96'>This</span>
      <span class='ocrx_word' id='word_1_2' title='bbox 319 117 380 185; x_wconf 96'>is</span>
      <span class='ocrx_word' id='word_1_3' title='bbox 412 140 451 187; x_wconf 96'>a</span>
      <span class='ocrx_word' id='word_1_4' title='bbox 478 124 774 210; x_wconf 96'>picture.</span>
     </span>
    </p>
   </div>
   <div class='ocr_carea' id='block_1_2' title="bbox 111 315 657 399">
    <p class='ocr_par' id='par_1_2' lang='eng' title="bbox 111 315 657 399">
     <span class='ocr_line' id='line_1_2' title="bbox 111 315 657 399; baseline 0.035 -27; x_size 73; x_descenders 14; x_ascenders 19">
      <span class='ocrx_word' id='word_1_5' title='bbox 111 315 252 376; x_wconf 96'>This</span>
      <span class='ocrx_word' id='word_1_6' title='bbox 278 322 329 379; x_wconf 96'>is</span>
      <span class='ocrx_word' id='word_1_7' title='bbox 356 341 389 380; x_wconf 96'>a</span>
      <span class='ocrx_word' id='word_1_8' title='bbox 411 328 657 399; x_wconf 96'>picture.</span>
     </span>
    </p>
   </div>
   <div class='ocr_carea' id='block_1_3' title="bbox 104 502 541 571">
    <p class='ocr_par' id='par_1_3' lang='eng' title="bbox 104 502 541 571">
     <span class='ocr_line' id='line_1_3' title="bbox 104 502 541 571; baseline 0.034 -22; x_size 60; x_descenders 12; x_ascenders 16">
      <span class='ocrx_word' id='word_1_9' title='bbox 104 502 218 552; x_wconf 96'>This</span>
      <span class='ocrx_word' id='word_1_10' title='bbox 238 508 280 554; x_wconf 94'>is</span>
      <span class='ocrx_word' id='word_1_11' title='bbox 300 523 326 555; x_wconf 94'>a</span>
      <span class='ocrx_word' id='word_1_12' title='bbox 344 513 541 571; x_wconf 96'>picture.</span>
     </span>
    </p>
   </div>
   <div class='ocr_carea' id='block_1_4' title="bbox 98 672 462 729">
    <p class='ocr_par' id='par_1_4' lang='eng' title="bbox 98 672 462 729">
     <span class='ocr_line' id='line_1_4' title="bbox 98 672 462 729; baseline 0.036 -19; x_size 49; x_descenders 10; x_ascenders 12">
      <span class='ocrx_word' id='word_1_13' title='bbox 98 672 193 713; x_wconf 96'>This</span>
      <span class='ocrx_word' id='word_1_14' title='bbox 209 676 244 715; x_wconf 93'>is</span>
      <span class='ocrx_word' id='word_1_15' title='bbox 261 689 283 716; x_wconf 93'>a</span>
      <span class='ocrx_word' id='word_1_16' title='bbox 298 681 462 729; x_wconf 94'>picture.</span>
     </span>
    </p>
   </div>
   <div class='ocr_carea' id='block_1_5' title="bbox 92 829 384 873">
    <p class='ocr_par' id='par_1_5' lang='eng' title="bbox 92 829 384 873">
     <span class='ocr_line' id='line_1_5' title="bbox 92 829 384 873; baseline 0.034 -14; x_size 38; x_descenders 7; x_ascenders 10">
      <span class='ocrx_word' id='word_1_17' title='bbox 92 829 167 861; x_wconf 96'>This</span>
      <span class='ocrx_word' id='word_1_18' title='bbox 182 832 209 862; x_wconf 96'>is</span>
      <span class='ocrx_word' id='word_1_19' title='bbox 223 842 240 863; x_wconf 96'>a</span>
      <span class='ocrx_word' id='word_1_20' title='bbox 252 836 384 873; x_wconf 91'>picture.</span>
     </span>
    </p>
   </div>
  </div>
  <div class="options">
  	<h2>Options</h2>
  	<form>
  	  <fieldset>
    <ul>
      <li> 
        <label>
          <input type="checkbox" name="conf" checked="checked" value="on">
          show word confidencies
        </label>
      </li>
      <li>
        <label>
          <input type="checkbox" name="para"  value="on">
          show paragraphs
        </label> 
      </li>
      <li>
        <label>
          <input type="checkbox" name="block"  value="on">
          show block boxes
        </label>
      </li>
      <li>
        <label>
          <input type="checkbox" name="line"  value="on">
          show line boxes
        </label>
      </li>
      <li>
        <label>
          <input type="checkbox" name="fraktur"  value="on">
          Fraktur
        </label>       
      </li>
    </ul> 
  </fieldset>
</form>

<!-- form action="#" onsubmit="return false">
	<p><textarea id="inputFileNameToSaveAs" style="width: 100%" rows=1>test.txt</textarea></p>
	<p><input type="button" onClick="saveTextAsFile()" value="save as file"></p>
</form -->

        <form id="html-options">
            <label>Filename: <input type="text" class="filename" id="html-filename" placeholder="test"/>.html</label>
            <input type="submit" value="Save HTML"/>
        </form>

  </div>
</div>


<script type="text/javascript" src="../js/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="../js/FileSaver.min.js"></script>
<script type="text/javascript">
(function(view) {
"use strict";
var
	  document = view.document
	, $ = function(id) {
		return document.getElementById(id);
	}
	, session = view.sessionStorage
	// only get URL when necessary in case Blob.js hasn't defined it yet
	, get_blob = function() {
		return view.Blob;
	}

	, html = $("html")
	, html_options_form = $("html-options")
	, html_filename = $("html-filename")

	// Title guesser and document creator available at https://gist.github.com/1059648
	, guess_title = function(doc) {
		var
			  h = "h6 h5 h4 h3 h2 h1".split(" ")
			, i = h.length
			, headers
			, header_text
		;
		while (i--) {
			headers = doc.getElementsByTagName(h[i]);
			for (var j = 0, len = headers.length; j < len; j++) {
				header_text = headers[j].textContent.trim();
				if (header_text) {
					return header_text;
				}
			}
		}
	}
	, doc_impl = document.implementation
	, create_html_doc = function(html) {
		var
			  dt = doc_impl.createDocumentType('html', null, null)
			, doc = doc_impl.createDocument("http://www.w3.org/1999/xhtml", "html", dt)
			, doc_el = doc.documentElement
			, doc_html = doc_el.appendChild(doc.createElement("html"))
			/*, head = doc_el.appendChild(doc.createElement("head"))
			, charset_meta = head.appendChild(doc.createElement("meta"))
			, title = head.appendChild(doc.createElement("title"))
			, body = doc_el.appendChild(doc.createElement("body"))
			*/
			, i = 0
			, len = html.childNodes.length
		;
		// charset_meta.setAttribute("charset", html.ownerDocument.characterSet);
		for (; i < len; i++) {
			//body.appendChild(doc.importNode(html.childNodes.item(i), true));
			doc_html.appendChild(doc.importNode(html.childNodes.item(i), true));
		}
		/* 
		var title_text = guess_title(doc);
		if (title_text) {
			title.appendChild(doc.createTextNode(title_text));
		}
		*/
		return doc;
	}
;

html_options_form.addEventListener("submit", function(event) {
	event.preventDefault();
	var
		  BB = get_blob()
		, xml_serializer = new XMLSerializer()
		, doc = create_html_doc(html)
	;
	saveAs(
		  new BB(
			  [xml_serializer.serializeToString(doc)]
			, {type: "text/plain;charset=" + document.characterSet}
		)
		, (html_filename.value || html_filename.placeholder) + ".html"
	);
}, false);

view.addEventListener("unload", function() {

	session.html = html.innerHTML;
	session.html_filename = html_filename.value;
}, false);
}(self));


</script>

<!-- script type="text/javascript">
// http://stackoverflow.com/questions/585234/how-to-read-and-write-into-file-using-javascript
// http://stackoverflow.com/questions/21012580/is-it-possible-to-write-data-to-file-using-only-javascript
function saveTextAsFile() {
    var textToWrite = document.getElementById("inputTextToSave").value;
    var textFileAsBlob = new Blob([textToWrite], {type:'text/plain'});
    var fileNameToSaveAs = document.getElementById("inputFileNameToSaveAs").value;
      var downloadLink = document.createElement("a");
    downloadLink.download = fileNameToSaveAs;
    downloadLink.innerHTML = "Download File";
    if (window.webkitURL != null) {
        // Chrome allows the link to be clicked
        // without actually adding it to the DOM.
        downloadLink.href = window.webkitURL.createObjectURL(textFileAsBlob);
    }
    else {
        // Firefox requires the link to be added to the DOM
        // before it can be clicked.
        downloadLink.href = window.URL.createObjectURL(textFileAsBlob);
        downloadLink.onclick = destroyClickedElement;
        downloadLink.style.display = "none";
        document.body.appendChild(downloadLink);
    }

    downloadLink.click();
}
</script -->


<script type="text/javascript">

var scale_w = 1.0;
var scale_h = 1.0;
var wf = 0;
var hf = 0;
var iw = 0;
var ih = 0;

function getTopPos(el) {
    for (var topPos = 0;
        el != null;
        topPos += el.offsetTop, el = el.offsetParent);
    return topPos;
}

$(document).ready(function() {
    // Featured editor
    iw=$('.scan img')[0].width;
    ih=$('.scan img')[0].height;
    var arrf = $('#page_1').attr("title").match(/bbox\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)/);
    wf = arrf[3];
    hf = arrf[4];
    //alert('wf hf ' + wf + ' ' + hf);
    scale_w = iw / wf;
    scale_h = ih / hf;
        
    $('.ocrx_word').each( function(index, element) {
       oid = 'o' + $(element).attr('id');
       $(element).attr('contenteditable','true');

       var e = $(document.createElement('div'));
       e.attr('id',oid);
       e.attr('class','bbox');
       var arr = $(element).attr("title").match(/bbox (\d+) (\d+) (\d+) (\d+)/);
       var x1 = arr[1] * scale_w -1;
       var y1 = arr[2] * scale_h -1;
       var x2 = arr[3] * scale_w -1;
       var y2 = arr[4] * scale_w -1; 
       
       var w = x2 - x1;
       var h = y2 - y1; 

       e.css('width',w+'px');
       e.css('height',h+'px');
       e.css('top',y1+'px');
       e.css('left',x1+'px');
       e.appendTo('#layer');      
    });  
    $('.ocrx_word').each( function(index, element) {
       oid = 'o' + $(element).attr('id');
       $(element).attr('contenteditable','true');

       var arr = $(element).attr("title").match(/x_wconf (\d+)/);
       var conf = arr[1];
       
       if (conf < 80) {
         $(element).css('background-color','#ffff99'); // yellow ffff99
       }
       if (conf < 70) {
         $(element).css('background-color','#ffcc99'); // orange ffcc99
       }
       if (conf < 60) {
         $(element).css('background-color','#ff9999'); // red #ff9999
       }      
    });      
});

</script>
<script type="text/javascript">
$(document).on('change', ':checkbox[name=conf]', function() {
    if(this.checked) {
    $('.ocrx_word').each( function(index, element) {

       var arr = $(element).attr("title").match(/x_wconf (\d+)/);
       var conf = arr[1];
       
       if (conf < 80) {
         $(element).css('background-color','#ffff99'); // yellow ffff99
       }
       if (conf < 70) {
         $(element).css('background-color','#ffcc99'); // orange ffcc99
       }
       if (conf < 60) {
         $(element).css('background-color','#ff9999'); // red #ff9999
       }      
    });
    }
    else {
    $('.ocrx_word').each( function(index, element) {
       var arr = $(element).attr("title").match(/x_wconf (\d+)/);
       $(element).css('background-color','inherit');    
    });   
    }
});
$(document).on('change', ':checkbox[name=block]', function() {
    if(this.checked) {
    $('.ocr_carea').each( function(index, element) {
         $(element).css('border-color','#f00'); 
    });
    }
    else {
    $('.ocr_carea').each( function(index, element) {
       $(element).css('border-color','transparent');    
    });   
    }
})
$(document).on('change', ':checkbox[name=para]', function() {
    if(this.checked) {
    $('.ocr_par').each( function(index, element) {
         $(element).css('border-color','#0f0'); 
    });
    }
    else {
    $('.ocr_par').each( function(index, element) {
       $(element).css('border-color','transparent');    
    });   
    }
})
$(document).on('change', ':checkbox[name=line]', function() {
    if(this.checked) {
    $('.ocr_line').each( function(index, element) {
         $(element).css('border-color','#00f'); 
    });
    }
    else {
    $('.ocr_line').each( function(index, element) {
       $(element).css('border-color','transparent');    
    });   
    }
})
$(document).on('change', ':checkbox[name=fraktur]', function() {
    if(this.checked) {
    $('.ocr_page').each( function(index, element) {
         $(element).css('font-family','BreitkopfFraktur'); 
    });
    }
    else {
    $('.ocr_page').each( function(index, element) {
       $(element).css('font-family','inherit');    
    });   
    }
})
</script>
<script type="text/javascript">
var current_wid = '';
var current_oid = '';

/* click into scan image */
$(document).ready(function() {
  //$(".bbox").mouseover(function(){
  $(".bbox").click(function(){
    var wid = $(this).attr('id').replace(/^o/, '');
    
    var oid = $(this).attr('id');
    if (current_wid != '') {
       // $("#" + current_wid).css('background-color','inherit');
        $("#" + current_wid).css('border-color','transparent');
    }
    current_wid = wid;
    // $("#" + wid).css('background-color','yellow');
    $("#" + wid).css('border-color','red');
    if (current_oid != '') {
       $("#" + current_oid).css('border-color','transparent'); 
    }
    current_oid = oid;
    $("#" + oid).css('border-color','red');
    
    //var el = $("#" + wid);
    var el = document.getElementById(wid);
    var itop = getTopPos(el);
    //alert('itop2 ' + itop);
    $('#page_1').scrollTop(itop-50);
  })
});

/* click into text */
$(document).ready(function() {
  //$(".ocrx_word").mouseover(function(){
  // addEventListener(element, 'click', clickHandler, false);
  //addEventListener($(".ocrx_word"), 'click', function(){
  $(".ocrx_word").click(function(){
    var wid = $(this).attr('id');
    var oid = 'o' + $(this).attr('id');
    if (current_wid != '') {
       // $("#" + current_wid).css('background-color','inherit');
       $("#" + current_wid).css('border-color','transparent'); 
    }
    current_wid = wid;
    // $("#" + wid).css('background-color','yellow'); 
    $("#" + wid).css('border-color','red');
    if (current_oid != '') {
       $("#" + current_oid).css('border-color','transparent'); 
    }
    current_oid = oid;
    $("#" + oid).css('border-color','red');
    
    var ileft = $("#" + oid).css('left').replace(/px/,'');
    var itop = $("#" + oid).css('top').replace(/px/,'');
    //$(this).closest('.ocr_line'); // find closest parent line
    // Math.floor(e), .ceil, .round
    // alert('itop ileft '+ itop +' ' + ileft);
    $(".scan").scrollLeft(ileft);
    $(".scan").scrollTop(itop);    
  })
});

</script>
 </body>
</html>
